<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malë Mi Ğöä</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons (for simple icons) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm py-4 px-6 md:px-8">
        <div class="container flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <!-- Updated logo source to your uploaded image -->
                <img src="/Wordmark%20Logo%20for%20'male%20mi%20Goa'%20App.png-0c165c51-6b6a-44b9-9a3a-3d3c9fa09ac1" alt="Malë Mi Ğöä Logo" class="h-10 w-10 rounded-full object-contain">
                <h1 class="text-2xl font-bold text-indigo-700">Malë Mi Ğöä</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="#dashboard" class="text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200">Dashboard</a>
                <a href="#insights" class="text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200">Insights</a>
                <a href="#predictions" class="text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200">Predictions</a>
                <a href="#scenarios" class="text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200">Scenarios</a>
                <a href="#about" class="text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200">About</a>
            </nav>
            <div class="md:hidden">
                <button id="menu-button" class="text-gray-600 hover:text-indigo-700 focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden mt-4 space-y-2">
            <a href="#dashboard" class="block text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200 px-4 py-2 rounded-md bg-gray-50">Dashboard</a>
            <a href="#insights" class="block text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200 px-4 py-2 rounded-md bg-gray-50">Insights</a>
            <a href="#predictions" class="block text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200 px-4 py-2 rounded-md bg-gray-50">Predictions</a>
            <a href="#scenarios" class="block text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200 px-4 py-2 rounded-md bg-gray-50">Scenarios</a>
            <a href="#about" class="block text-gray-600 hover:text-indigo-700 font-medium transition-colors duration-200 px-4 py-2 rounded-md bg-gray-50">About</a>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container py-8">
        <!-- User ID Display -->
        <div id="user-id-display" class="bg-indigo-100 text-indigo-800 p-3 rounded-lg mb-6 shadow-md text-sm">
            Loading user ID...
        </div>

        <!-- Dashboard Section -->
        <section id="dashboard" class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-indigo-700 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard mr-3"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
                Dashboard Overview
            </h2>
            <p class="text-gray-600 mb-6">Real-time insights and predictive analytics covering conflict, climate change, migration patterns (human, animal, bird), daily weather, public health (nutrition, GBV, child protection), population dynamics, and living standards across South Sudan, from capital to village level, and relevant global events.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                <!-- Card 1: Conflict Incidents -->
                <div class="bg-red-50 border border-red-200 p-5 rounded-lg shadow-sm flex items-center space-x-4">
                    <div class="p-3 bg-red-200 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-swords text-red-600"><path d="M14.5 17.5 3 6 3 3 6 3l11.5 11.5"/><path d="M20.5 6.5 12 15 12 21 15 21 20.5 15.5"/><path d="M17 14 10 7"/></svg>
                    </div>
                    <div>
                        <p class="text-sm text-red-700 font-medium">Conflict Incidents (Last 24h)</p>
                        <p class="text-3xl font-bold text-red-800" id="conflict-incidents">--</p>
                    </div>
                </div>
                <!-- Card 2: Displaced Persons -->
                <div class="bg-blue-50 border border-blue-200 p-5 rounded-lg shadow-sm flex items-center space-x-4">
                    <div class="p-3 bg-blue-200 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users-round text-blue-600"><path d="M18 21a8 8 0 0 0-16 0"/><circle cx="10" cy="8" r="5"/><path d="M22 21a4 4 0 0 0-4-4H10"/><circle cx="18" cy="10" r="4"/></svg>
                    </div>
                    <div>
                        <p class="text-sm text-blue-700 font-medium">New Displacements (Last Week)</p>
                        <p class="text-3xl font-bold text-blue-800" id="displaced-persons">--</p>
                    </div>
                </div>
                <!-- Card 3: Food Insecurity Level -->
                <div class="bg-yellow-50 border border-yellow-200 p-5 rounded-lg shadow-sm flex items-center space-x-4">
                    <div class="p-3 bg-yellow-200 rounded-full">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wheat text-yellow-600"><path d="M2 22 16 8"/><path d="M22 2L8 16"/><path d="M12 2v20"/><path d="M3 3v1a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2V3"/><path d="M16 3v1a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2V3"/><path d="M3 21v-1a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v1"/><path d="M16 21v-1a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v1"/></svg>
                    </div>
                    <div>
                        <p class="text-sm text-yellow-700 font-medium">Food Insecurity Level (IPC)</p>
                        <p class="text-3xl font-bold text-yellow-800" id="food-insecurity">--</p>
                    </div>
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 shadow-sm">
                <h3 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring mr-2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 14.05a2 2 0 1 0 3.28 0"/><path d="M2 12c-.2.8-.3 1.5-.3 2.2 0 2.4 1.7 4.3 3.9 4.8A4.7 4.7 0 0 0 8 20c.5 0 1-.1 1.5-.2"/><path d="M22 12c.2.8.3 1.5.3 2.2 0 2.4-1.7 4.3-3.9 4.8A4.7 4.7 0 0 1 16 20c-.5 0-1-.1-1.5-.2"/></svg>
                    Real-time Alerts
                </h3>
                <ul id="alerts-list" class="space-y-3">
                    <!-- Alerts will be loaded here -->
                    <li class="p-3 bg-red-100 border border-red-300 rounded-md flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert text-red-600 flex-shrink-0 mt-1 mr-3"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        <div>
                            <p class="font-semibold text-red-800">High Risk of Conflict Escalation in Jonglei State</p>
                            <p class="text-sm text-red-700">Increased cattle raiding and localized clashes reported in Bor and Akobo counties. AI prediction: 75% likelihood of further escalation in next 72 hours.</p>
                        </div>
                    </li>
                    <li class="p-3 bg-yellow-100 border border-yellow-300 rounded-md flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-circle text-yellow-600 flex-shrink-0 mt-1 mr-3"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
                        <div>
                            <p class="font-semibold text-yellow-800">Moderate Risk of Cholera Outbreak in Bentiu IDP Camp</p>
                            <p class="text-sm text-yellow-700">Increased cases of acute watery diarrhea detected. AI suggests immediate sanitation and hygiene interventions.</p>
                        </div>
                    </li>
                    <li class="p-3 bg-green-100 border border-green-300 rounded-md flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle text-green-600 flex-shrink-0 mt-1 mr-3"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                        <div>
                            <p class="font-semibold text-green-800">Improved Food Access in Western Equatoria</p>
                            <p class="text-sm text-green-700">Market functionality has improved, and food prices are stabilizing. AI indicates reduced food insecurity levels.</p>
                        </div>
                    </li>
                </ul>
            </div>
        </section>

        <!-- Insights Section -->
        <section id="insights" class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-indigo-700 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bar-chart-2 mr-3"><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>
                Deep Insights & Analysis
            </h2>
            <p class="text-gray-600 mb-6">Explore detailed reports and causal analysis generated by the AI model, covering interconnected factors influencing stability and well-being.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Report: Drivers of Displacement in Unity State</h3>
                    <p class="text-gray-600 text-sm mb-4">AI analysis indicates a strong correlation between localized flooding, cattle migration routes, and inter-communal violence as primary drivers of recent displacement in Unity State. Recommendations include integrated water management and peacebuilding dialogues.</p>
                    <button class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition-colors duration-200">Read Full Report</button>
                </div>
                <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Causal Map: Food Insecurity & Conflict</h3>
                    <p class="text-gray-600 text-sm mb-4">Interactive visualization showing the causal links between climate shocks, market disruptions, and conflict incidents leading to food insecurity. Highlights critical intervention points.</p>
                    <button class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition-colors duration-200">View Causal Map</button>
                </div>
            </div>
        </section>

        <!-- Predictions Section -->
        <section id="predictions" class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-indigo-700 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up mr-3"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                Future Predictions
            </h2>
            <p class="text-gray-600 mb-6">Forecasts for various indicators and potential future problems generated by the AI model, including early warnings for conflict, climate events, and disease outbreaks.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-50 border border-gray-200 p-5 rounded-lg shadow-sm">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Conflict Risk Forecast (Next 3 Months)</h3>
                    <p class="text-gray-600 text-sm mb-4">AI predicts a moderate to high risk of increased localized conflict in areas bordering the Equatorias due to resource competition and political maneuvering ahead of potential elections. Specific hotspots identified.</p>
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                        <div class="bg-orange-500 h-4 rounded-full" style="width: 70%;"></div>
                    </div>
                    <p class="text-sm text-gray-700 font-medium">Risk Level: High (70%)</p>
                </div>
                <div class="bg-gray-50 border border-gray-200 p-5 rounded-lg shadow-sm">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3">Economic Stability Outlook (Next 6 Months)</h3>
                    <p class="text-gray-600 text-sm mb-4">Forecast shows continued economic challenges with high inflation, but potential for slight stabilization if oil prices remain consistent and peace agreement implementation progresses. Diversification remains crucial.</p>
                    <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                        <div class="bg-yellow-500 h-4 rounded-full" style="width: 45%;"></div>
                    </div>
                    <p class="text-sm text-gray-700 font-medium">Stability: Moderate (45%)</p>
                </div>
            </div>

            <div class="mt-8 p-6 bg-indigo-50 rounded-lg border border-indigo-200 shadow-sm">
                <h3 class="text-xl font-semibold text-indigo-700 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot mr-2"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 11v2"/><path d="M9 11v2"/></svg>
                    Ask the AI Model for Insights & Solutions
                </h3>
                <textarea id="llm-prompt" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 mb-4 resize-y" rows="4" placeholder="e.g., 'What are the top 3 emerging risks in Equatoria region for the next year and what are actionable solutions?', or 'Predict the impact of heavy rainfall in Jonglei on human migration and food security.'"></textarea>
                <button id="generate-insight-btn" class="bg-indigo-600 text-white px-6 py-3 rounded-md hover:bg-indigo-700 transition-colors duration-200 font-semibold shadow-md">
                    Generate AI Insight
                </button>
                <div id="llm-response-area" class="mt-4 p-4 bg-white border border-gray-200 rounded-md shadow-inner hidden">
                    <p class="font-semibold text-indigo-800 mb-2">AI Response:</p>
                    <div id="llm-response-content" class="text-gray-700 prose max-w-none"></div>
                    <div id="llm-loading-indicator" class="hidden text-center text-indigo-600 mt-2">
                        <svg class="animate-spin h-5 w-5 text-indigo-600 inline-block mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Generating response...
                    </div>
                </div>
            </div>
        </section>

        <!-- Scenarios Section -->
        <section id="scenarios" class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <h2 class="text-3xl font-semibold text-indigo-700 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-route mr-3"><circle cx="6" cy="19" r="3"/><path d="M10.2 18H16V6H12"/><circle cx="18" cy="6" r="3"/><path d="M19.2 12H16"/></svg>
                Scenario Simulation & Problem Solving
            </h2>
            <p class="text-gray-600 mb-6">Simulate the impact of different interventions or external events on future outcomes, and explore AI-generated solutions for complex challenges.</p>
            <div class="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm">
                <h3 class="text-xl font-semibold text-gray-700 mb-3">Simulate Aid Intervention</h3>
                <p class="text-gray-600 text-sm mb-4">Model the effects of increased humanitarian aid on food security and displacement in a specific region.</p>
                <div class="flex flex-col md:flex-row gap-4 mb-4">
                    <input type="text" placeholder="Region (e.g., Unity State)" class="flex-grow p-2 border border-gray-300 rounded-md">
                    <input type="number" placeholder="Aid Increase (%)" class="w-full md:w-auto p-2 border border-gray-300 rounded-md">
                </div>
                <button class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors duration-200">Run Simulation</button>
                <div class="mt-4 p-3 bg-green-100 rounded-md text-green-800 hidden" id="simulation-result">
                    <p class="font-semibold">Simulation Result:</p>
                    <p>Expected 15% reduction in acute food insecurity and 10% decrease in new displacements over 3 months with specified aid intervention.</p>
                </div>
            </div>
            <div class="bg-indigo-50 p-5 rounded-lg border border-indigo-200 shadow-sm mt-6">
                <h3 class="text-xl font-semibold text-indigo-700 mb-3">AI-Powered Problem Solver</h3>
                <p class="text-gray-600 text-sm mb-4">Input a specific problem or challenge, and the AI will propose actionable strategies and solutions.</p>
                <textarea class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 mb-4 resize-y" rows="3" placeholder="e.g., 'Propose strategies to mitigate inter-communal conflict over cattle in Jonglei State.'"></textarea>
                <button class="bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 transition-colors duration-200">Generate Solutions</button>
                <div class="mt-4 p-3 bg-indigo-100 rounded-md text-indigo-800 hidden" id="solution-result">
                    <p class="font-semibold">Proposed Solutions:</p>
                    <p>AI suggests establishing local peace committees, implementing community-led disarmament programs, and investing in alternative livelihood projects to reduce reliance on cattle.</p>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-3xl font-semibold text-indigo-700 mb-6 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mr-3"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                About Malë Mi Ğöä
            </h2>
            <p class="text-gray-600 mb-4">Malë Mi Ğöä (Nuer for "greeting") is an innovative AI-powered platform with an expansive mission: to provide real-time monitoring, predictive analytics, and actionable solutions for complex challenges across South Sudan and the broader African continent.</p>
            <p class="text-gray-600 mb-4">Leveraging advanced AI models like Gemini, this system integrates diverse data sources to offer a holistic understanding of critical factors including: **conflict dynamics, climate change impacts (rainfall, temperature extremes), human and animal migration patterns, daily weather updates, public health indicators (nutrition, GBV, child protection), population growth, overall life standards, and real-time current events.** Our analysis extends from the capital cities down to the village level, providing granular insights.</p>
            <p class="text-gray-600 mb-4">Our core objective is to empower decision-makers and communities with the foresight and tools needed to proactively address and **solve** pressing problems, fostering enduring peace, stability, and sustainable development for South Sudan and the entire world.</p>
            <p class="text-gray-600">For more information, please contact our support team.</p>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 px-6 md:px-8 mt-auto">
        <div class="container text-center text-sm">
            <p>&copy; 2025 Malë Mi Ğöä. All rights reserved.</p>
            <p class="mt-2">Empowering Peace Through Data and AI.</p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // Removed Firebase Functions import: import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";

        // Your ACTUAL Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAyFfw2pSl9hM-J6x9QWAuL9HOJ-5w1-xU",
            authDomain: "malemigoaapp.firebaseapp.com",
            projectId: "malemigoaapp",
            storageBucket: "malemigoaapp.firebasestorage.app",
            messagingSenderId: "995934306337",
            appId: "1:995934306337:web:26736d0da2602483776360",
            measurementId: "G-RXSBMPWWTF" // Optional: if you enabled Google Analytics
        };

        let app, db, auth, userId; // Removed 'functions' variable

        // Function to update dashboard with mock data (keep this for error fallback)
        function updateDashboardWithMockData() {
            const mockData = {
                conflictIncidents: 28,
                displacedPersons: 12500,
                foodInsecurity: "IPC Phase 3 (Crisis)"
            };
            document.getElementById('conflict-incidents').textContent = mockData.conflictIncidents;
            document.getElementById('displaced-persons').textContent = mockData.displacedPersons.toLocaleString();
            document.getElementById('food-insecurity').textContent = mockData.foodInsecurity;
        }

        // Function to initialize Firebase and authenticate
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                // Removed Firebase Functions initialization: functions = getFunctions(app);

                // For external deployment, we'll sign in anonymously directly
                await signInAnonymously(auth);
                console.log("Signed in anonymously.");

                // Listen for auth state changes to get the user ID
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').textContent = `Logged in as: ${userId}`;
                        console.log("User ID:", userId);
                        // Once authenticated, start listening for data
                        listenForDashboardData();
                    } else {
                        userId = crypto.randomUUID(); // Fallback if anonymous sign-in fails or user logs out
                        document.getElementById('user-id-display').textContent = `Session ID: ${userId} (Anonymous)`;
                        console.log("No user signed in, using random session ID:", userId);
                        listenForDashboardData();
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
                document.getElementById('user-id-display').textContent = `Error: ${error.message}`;
                updateDashboardWithMockData(); // Show mock data on error
            }
        }

        // Function to listen for dashboard data from Firestore
        function listenForDashboardData() {
            // Only proceed if Firebase is initialized and userId is available
            if (!db || !userId) {
                console.warn("Firestore or User ID not available yet. Retrying data listener...");
                setTimeout(listenForDashboardData, 1000); // Retry after 1 second
                return;
            }

            // For external deployment, we are using a simplified path 'dashboardData'
            const collectionPath = 'dashboardData';
            const dashboardCollectionRef = collection(db, collectionPath);
            const q = query(dashboardCollectionRef);

            onSnapshot(q, (snapshot) => {
                let data = {};
                if (!snapshot.empty) {
                    data = snapshot.docs[0].data();
                    console.log("Dashboard data received:", data);
                } else {
                    console.log("No dashboard data found in Firestore. Using mock data.");
                    updateDashboardWithMockData();
                    return;
                }

                document.getElementById('conflict-incidents').textContent = data.conflictIncidents || '--';
                document.getElementById('displaced-persons').textContent = data.displacedPersons ? data.displacedPersons.toLocaleString() : '--';
                document.getElementById('food-insecurity').textContent = data.foodInsecurity || '--';

            }, (error) => {
                console.error("Error fetching dashboard data:", error);
                document.getElementById('conflict-incidents').textContent = 'Error';
                document.getElementById('displaced-persons').textContent = 'Error';
                document.getElementById('food-insecurity').textContent = 'Error';
                updateDashboardWithMockData();
            });
        }

        // Initialize Firebase when the window loads
        window.onload = initializeFirebase;

        // --- UI Interactivity ---

        // Mobile menu toggle
        const menuButton = document.getElementById('menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        menuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Close mobile menu when a link is clicked
        mobileMenu.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });
        });

        // Simulate scenario button
        document.querySelector('#scenarios button').addEventListener('click', () => {
            const resultDiv = document.getElementById('simulation-result');
            resultDiv.classList.remove('hidden');
            setTimeout(() => resultDiv.classList.add('hidden'), 5000); // Hide after 5 seconds
        });

        // Simulate AI-Powered Problem Solver button
        document.querySelector('#scenarios .bg-indigo-50 button').addEventListener('click', () => {
            const solutionResultDiv = document.getElementById('solution-result');
            solutionResultDiv.classList.remove('hidden');
            setTimeout(() => solutionResultDiv.classList.add('hidden'), 8000); // Hide after 8 seconds
        });


        // --- LLM Integration (Calling Vercel Serverless Function) ---
        const generateInsightBtn = document.getElementById('generate-insight-btn');
        const llmPromptInput = document.getElementById('llm-prompt');
        const llmResponseArea = document.getElementById('llm-response-area');
        const llmResponseContent = document.getElementById('llm-response-content');
        const llmLoadingIndicator = document.getElementById('llm-loading-indicator');

        generateInsightBtn.addEventListener('click', async () => {
            const prompt = llmPromptInput.value.trim();
            if (!prompt) {
                llmResponseContent.innerHTML = '<p class="text-red-600">Please enter a prompt.</p>';
                llmResponseArea.classList.remove('hidden');
                return;
            }

            llmResponseContent.innerHTML = ''; // Clear previous response
            llmResponseArea.classList.remove('hidden');
            llmLoadingIndicator.classList.remove('hidden');
            generateInsightBtn.disabled = true; // Disable button during generation

            try {
                // Call the Vercel Serverless Function at /api/gemini
                const response = await fetch('/api/gemini', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: prompt }), // Send prompt as JSON
                });

                const data = await response.json();

                if (response.ok && data.success) { // Check both HTTP status and custom success flag
                    llmResponseContent.innerHTML = `<p>${data.text}</p>`;
                } else {
                    llmResponseContent.innerHTML = `<p class="text-red-600">Could not get a valid response from the AI model via Vercel Function. Error: ${data.error || 'Unknown'}</p>`;
                    console.error("Vercel Function response error:", data);
                }
            } catch (error) {
                llmResponseContent.innerHTML = `<p class="text-red-600">Error calling Vercel Function: ${error.message}</p>`;
                console.error("Vercel Function call error:", error);
            } finally {
                llmLoadingIndicator.classList.add('hidden');
                generateInsightBtn.disabled = false; // Re-enable button
            }
        });

    </script>
</body>
</html>
